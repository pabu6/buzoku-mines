<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ÈÉ®Êóè„ÅÆÁî∑„Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë„Éº</title>

<style>
body {
  margin: 0;
  font-family: sans-serif;
  background: #102018;
  display: flex;
  color: #fff;
}

/* ===== „Ç≤„Éº„É†Áõ§ ===== */
#game {
  padding: 20px;
}

table {
  border-collapse: collapse;
}

td {
  width: 36px;
  height: 36px;
  border: 1px solid #1b3a2a;
  background: #2e6b4f;
  text-align: center;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.15s, background 0.15s;
}

td:hover {
  background: #3f8f6b;
}

td.open {
  background: #cfd8dc;
  cursor: default;
  transform: scale(0.95);
}

/* ===== Êï∞Â≠ó„ÅÆËâ≤ ===== */
.num1 { color: #1976d2; }
.num2 { color: #2e7d32; }
.num3 { color: #d32f2f; }
.num4 { color: #7b1fa2; }
.num5 { color: #5d4037; }
.num6 { color: #00838f; }
.num7 { color: #424242; }
.num8 { color: #000000; }

/* ===== Á∑ë„ÅÆÊóó ===== */
td.flag {
  background: #1b3a2a;
  color: #00ff66;
  font-size: 20px;
}

/* ===== ÈÉ®Êóè„ÅÆÁî∑ ===== */
td.enemy {
  background: black url("tribe.jpeg") center/cover no-repeat;
  animation: bite 0.4s ease;
}

/* ===== „Çµ„Ç§„Éâ ===== */
#side {
  width: 260px;
  padding: 20px;
  background: #08140f;
  text-align: center;
}

#explorer {
  width: 220px;
  transition: filter 0.5s, transform 0.5s;
}

#explorer.captured {
  filter: grayscale(30%) brightness(0.8);
  transform: scale(0.95);
}

#status {
  margin-top: 15px;
  font-size: 18px;
  font-weight: bold;
}

#status.clear {
  color: gold;
  font-size: 22px;
  text-shadow: 0 0 8px gold;
}

/* „É™„Çπ„Çø„Éº„Éà */
#restart {
  margin-top: 15px;
  padding: 8px 16px;
  font-size: 16px;
  background: #2e6b4f;
  border: none;
  color: white;
  cursor: pointer;
}

#restart:hover {
  background: #3f8f6b;
}

/* ===== „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ ===== */
@keyframes bite {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

@keyframes shake {
  0% { transform: translate(0); }
  25% { transform: translate(5px); }
  50% { transform: translate(-5px); }
  75% { transform: translate(5px); }
  100% { transform: translate(0); }
}

body.shake {
  animation: shake 0.4s;
}
</style>
</head>

<body>

<div id="game"></div>

<div id="side">
  <img id="explorer" src="explorer.jpeg">
  <div id="status">Êé¢Ê§úÈñãÂßãÔºÅ</div>
  <button id="restart">RESTART</button>
</div>

<audio id="seOpen" src="open.mp3"></audio>
<audio id="seFlag" src="flag.mp3"></audio>
<audio id="seDeath" src="death.mp3"></audio>

<script>
const ROWS = 9;
const COLS = 9;
const ENEMIES = 10;

let board = [];
let opened = [];
let flags = [];
let gameOver = false;

const explorerImg = document.getElementById("explorer");
const seOpen = document.getElementById("seOpen");
const seFlag = document.getElementById("seFlag");
const seDeath = document.getElementById("seDeath");

function play(se) {
  se.currentTime = 0;
  se.play();
}

document.getElementById("restart").onclick = () => init();

function init() {
  board = Array(ROWS).fill().map(() => Array(COLS).fill(0));
  opened = Array(ROWS).fill().map(() => Array(COLS).fill(false));
  flags = Array(ROWS).fill().map(() => Array(COLS).fill(false));
  gameOver = false;

  explorerImg.src = "explorer.jpeg";
  explorerImg.classList.remove("captured");

  document.body.classList.remove("shake");
  const status = document.getElementById("status");
  status.classList.remove("clear");
  status.textContent = "Êé¢Ê§úÈñãÂßãÔºÅ";

  let placed = 0;
  while (placed < ENEMIES) {
    let r = Math.floor(Math.random() * ROWS);
    let c = Math.floor(Math.random() * COLS);
    if (board[r][c] !== "E") {
      board[r][c] = "E";
      placed++;
    }
  }

  for (let r = 0; r < ROWS; r++) {
    for (let c = 0; c < COLS; c++) {
      if (board[r][c] === "E") continue;
      let count = 0;
      for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
          let nr = r + dr;
          let nc = c + dc;
          if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
            if (board[nr][nc] === "E") count++;
          }
        }
      }
      board[r][c] = count;
    }
  }

  draw();
}

function draw() {
  const game = document.getElementById("game");
  game.innerHTML = "";
  const table = document.createElement("table");

  for (let r = 0; r < ROWS; r++) {
    const tr = document.createElement("tr");
    for (let c = 0; c < COLS; c++) {
      const td = document.createElement("td");

      if (opened[r][c]) {
        td.classList.add("open");
        if (board[r][c] === "E") {
          td.classList.add("enemy");
        } else if (board[r][c] > 0) {
          td.textContent = board[r][c];
          td.classList.add("num" + board[r][c]);
        }
      } else if (flags[r][c]) {
        td.classList.add("flag");
        td.textContent = "üö©";
      }

      td.oncontextmenu = e => {
        e.preventDefault();
        if (!opened[r][c] && !gameOver) {
          flags[r][c] = !flags[r][c];
          play(seFlag);
          draw();
        }
      };

      td.onclick = () => {
        if (gameOver || flags[r][c]) return;
        openCell(r, c);
        draw();
      };

      tr.appendChild(td);
    }
    table.appendChild(tr);
  }

  game.appendChild(table);
}

function openCell(r, c) {
  if (opened[r][c]) return;
  opened[r][c] = true;
  play(seOpen);

  if (board[r][c] === "E") {
    gameOver = true;
    play(seDeath);
    document.body.classList.add("shake");

    explorerImg.src = "explorer_captured.jpeg";
    explorerImg.classList.add("captured");

    document.getElementById("status").textContent =
      "Êçï„Åæ„Å£„Å¶„Åó„Åæ„Å£„Åü‚Ä¶";

    for (let i = 0; i < ROWS; i++) {
      for (let j = 0; j < COLS; j++) {
        if (board[i][j] === "E") opened[i][j] = true;
      }
    }
    return;
  }

  if (board[r][c] === 0) {
    for (let dr = -1; dr <= 1; dr++) {
      for (let dc = -1; dc <= 1; dc++) {
        let nr = r + dr;
        let nc = c + dc;
        if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
          if (!opened[nr][nc]) openCell(nr, nc);
        }
      }
    }
  }

  checkClear();
}

function checkClear() {
  let safe = ROWS * COLS - ENEMIES;
  let count = 0;
  for (let r = 0; r < ROWS; r++) {
    for (let c = 0; c < COLS; c++) {
      if (opened[r][c] && board[r][c] !== "E") count++;
    }
  }

  if (count === safe) {
    gameOver = true;
    const status = document.getElementById("status");
    status.textContent = "CONGRATULATIONS!!";
    status.classList.add("clear");
  }
}

init();
</script>

</body>
</html>
